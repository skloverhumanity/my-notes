<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <title>AI MindMap - Final Success Version</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.2.4/dist/mermaid.min.js"></script>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; height: 100vh; margin: 0; background: #f0f2f5; }
        .header { background: #1a73e8; color: white; padding: 15px; text-align: center; font-size: 20px; font-weight: bold; }
        .main { display: flex; flex: 1; overflow: hidden; }
        .sidebar { width: 320px; background: white; padding: 20px; border-right: 1px solid #ccc; box-shadow: 2px 0 5px rgba(0,0,0,0.1); }
        textarea, input { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; margin-bottom: 10px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; color: white; }
        .btn-ai { background: #8e24aa; }
        .btn-sample { background: #666; }
        #status { color: #d93025; font-size: 13px; margin-bottom: 10px; font-weight: bold; }
        .viewer { flex: 1; padding: 40px; overflow: auto; display: flex; justify-content: center; }
        #graph { background: white; padding: 20px; border-radius: 10px; border: 1px solid #ddd; min-width: 500px; text-align: center; }
    </style>
</head>
<body>

<div class="header">üß† AI MindMap Pro</div>

<div class="main">
    <div class="sidebar">
        <label style="font-size: 12px;">API Key:</label>
        <input type="password" id="apiKey" placeholder="‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§®‡§µ‡•Ä‡§® ‡§ï‡•Ä ‡§á‡§•‡•á ‡§ü‡§æ‡§ï‡§æ">
        <label style="font-size: 12px;">‡§µ‡§ø‡§∑‡§Ø:</label>
        <textarea id="topic" rows="3" placeholder="‡§â‡§¶‡§æ. Trading Strategy"></textarea>
        <div id="status">Ready</div>
        <button class="btn-ai" onclick="generateAI()">AI ‡§Æ‡§æ‡§á‡§Ç‡§° ‡§Æ‡•Ö‡§™ ‡§¨‡§®‡§µ‡§æ ‚ú®</button>
        <button class="btn-sample" onclick="showSample()">Sample (‡§ï‡•Ä ‡§∂‡§ø‡§µ‡§æ‡§Ø ‡§ö‡•á‡§ï ‡§ï‡§∞‡§æ)</button>
    </div>
    <div class="viewer">
        <div id="graph" class="mermaid"></div>
    </div>
</div>

<script>
    // ‡•ß. Mermaid Configuration
    mermaid.initialize({ startOnLoad: false, theme: 'forest', securityLevel: 'loose' });

    // ‡•®. ‡§ï‡•Ä ‡§∂‡§ø‡§µ‡§æ‡§Ø ‡§Æ‡•Ö‡§™ ‡§ö‡§æ‡§≤‡§§‡•ã‡§Ø ‡§ï‡§æ ‡§π‡•á ‡§™‡§æ‡§π‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä Sample Function
    function showSample() {
        const sampleCode = `mindmap
  root((Trading Strategy))
    Indicators
      RSI
      Moving Average
    Risk Management
      Stop Loss
      Position Sizing
    Entry Rules
      Breakout
      Retest`;
        renderMap(sampleCode);
    }

    // ‡•©. ‡§Æ‡•Ö‡§™ ‡§∞‡•á‡§Ç‡§°‡§∞ ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§ö‡•á ‡§´‡§Ç‡§ï‡•ç‡§∂‡§®
    async function renderMap(code) {
        const container = document.getElementById('graph');
        container.removeAttribute('data-processed');
        container.innerHTML = code;
        try {
            await mermaid.run({ nodes: [container] });
            document.getElementById('status').style.color = "green";
            document.getElementById('status').innerText = "‡§Æ‡•Ö‡§™ ‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä‡§∞‡•Ä‡§§‡•ç‡§Ø‡§æ ‡§§‡§Ø‡§æ‡§∞ ‡§ù‡§æ‡§≤‡§æ!";
        } catch (e) {
            document.getElementById('status').innerText = "Syntax Error! ‡§™‡•Å‡§®‡•ç‡§π‡§æ ‡§™‡•ç‡§∞‡§Ø‡§§‡•ç‡§® ‡§ï‡§∞‡§æ.";
        }
    }

    // ‡•™. ‡§Æ‡•Å‡§ñ‡•ç‡§Ø AI ‡§´‡§Ç‡§ï‡•ç‡§∂‡§®
    async function generateAI() {
        const key = document.getElementById('apiKey').value.trim();
        const topic = document.getElementById('topic').value.trim();
        const status = document.getElementById('status');

        if (!key || !topic) { alert("Key ‡§Ü‡§£‡§ø ‡§µ‡§ø‡§∑‡§Ø ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï!"); return; }

        status.style.color = "blue";
        status.innerText = "AI ‡§ï‡§°‡•Ç‡§® ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä ‡§ò‡•á‡§§ ‡§Ü‡§π‡•á...";

        const prompt = `Create a Mermaid.js mindmap for "${topic}". Start with 'mindmap' and 'root((Topic))'. Only code, no markdown.`;

        try {
            // v1beta version with 1.5-flash
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`;
            const res = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            });

            const data = await res.json();

            if (data.candidates && data.candidates[0].content) {
                let aiText = data.candidates[0].content.parts[0].text;
                let cleanCode = aiText.replace(/```mermaid|```/g, "").trim();
                renderMap(cleanCode);
            } else {
                status.innerText = "Error: ‡§ï‡•Ä ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§ ‡§®‡§æ‡§π‡•Ä‡§Ø‡•á.";
            }
        } catch (err) {
            status.innerText = "Connection Error!";
        }
    }
</script>

</body>
</html>
