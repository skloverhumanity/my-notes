<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <title>AI MindMap - Auto Model Fix</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        .sidebar { width: 300px; background: white; padding: 25px; border-right: 1px solid #ddd; box-shadow: 2px 0 10px rgba(0,0,0,0.05); }
        .viewer { flex: 1; display: flex; justify-content: center; align-items: center; background: #e9ecef; overflow: auto; position: relative; }
        input, textarea { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #1a73e8; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        #status { font-size: 13px; color: #666; margin-top: 10px; font-weight: bold; white-space: pre-wrap; }
        img { max-width: 95%; box-shadow: 0 10px 30px rgba(0,0,0,0.15); border-radius: 12px; display: none; background: white; }
    </style>
</head>
<body>

<div style="display: flex; flex: 1;">
    <div class="sidebar">
        <h3 style="color: #1a73e8;">üß† AI MindMap Pro</h3>
        <label style="font-size: 11px;">API Key:</label>
        <input type="password" id="apiKey" placeholder="‡§á‡§•‡•á ‡§ï‡•Ä ‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡§æ">
        <label style="font-size: 11px;">‡§µ‡§ø‡§∑‡§Ø:</label>
        <textarea id="topic" rows="4" placeholder="‡§â‡§¶‡§æ. Backtesting with GRU & LSTM"></textarea>
        <button onclick="startProcessing()">‡§Æ‡•Ö‡§™ ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§æ ‚ú®</button>
        <div id="status">Ready</div>
    </div>
    <div class="viewer">
        <div id="loader" style="display:none; font-weight: bold;">‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä ‡§§‡§Ø‡§æ‡§∞ ‡§π‡•ã‡§§ ‡§Ü‡§π‡•á...</div>
        <img id="mapResult" src="">
    </div>
</div>

<script>
async function startProcessing() {
    const key = document.getElementById('apiKey').value.trim();
    const topic = document.getElementById('topic').value.trim();
    const status = document.getElementById('status');
    const img = document.getElementById('mapResult');
    const loader = document.getElementById('loader');

    if (!key || !topic) { alert("Key ‡§Ü‡§£‡§ø ‡§µ‡§ø‡§∑‡§Ø ‡§¶‡•ã‡§®‡•ç‡§π‡•Ä ‡§ü‡§æ‡§ï‡§æ!"); return; }

    status.style.color = "#1a73e8";
    status.innerText = "‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§Æ‡•â‡§°‡•á‡§≤ ‡§∂‡•ã‡§ß‡§§ ‡§Ü‡§π‡•á...";
    loader.style.display = "block";
    img.style.display = "none";

    // ‡§Ü‡§™‡§£ ‡§è‡§ï‡§æ‡§Æ‡§æ‡§ó‡•Ç‡§® ‡§è‡§ï ‡•© ‡§Æ‡•â‡§°‡•á‡§≤‡•ç‡§∏ ‡§ö‡•á‡§ï ‡§ï‡§∞‡§£‡§æ‡§∞ ‡§Ü‡§π‡•ã‡§§
    const modelsToTry = [
        "gemini-1.5-flash",
        "gemini-1.5-flash-8b",
        "gemini-1.0-pro"
    ];

    let success = false;
    const prompt = `Create a Mermaid mindmap for "${topic}". Include nodes for GRU and LSTM models for fast backtesting. Give ONLY the mermaid code starting with "mindmap".`;

    for (const modelName of modelsToTry) {
        if (success) break;
        status.innerText = `Trying: ${modelName}...`;

        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${key}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            });

            const data = await response.json();

            if (data.candidates && data.candidates[0].content) {
                let aiCode = data.candidates[0].content.parts[0].text;
                let cleanCode = aiCode.replace(/```mermaid|```/g, "").trim();
                if (!cleanCode.startsWith("mindmap")) cleanCode = "mindmap\n" + cleanCode;

                const encoded = btoa(unescape(encodeURIComponent(cleanCode)));
                img.src = `https://kroki.io/mermaid/svg/${encoded}`;
                
                img.onload = () => {
                    loader.style.display = "none";
                    img.style.display = "block";
                    status.style.color = "green";
                    status.innerText = `‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä! (${modelName} ‡§∏‡§æ‡§™‡§°‡§≤‡•á)`;
                };
                success = true;
            }
        } catch (e) {
            console.log(modelName + " Failed");
        }
    }

    if (!success) {
        loader.style.display = "none";
        status.style.color = "red";
        status.innerText = "‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ Key ‡§≤‡§æ ‡§ï‡•ã‡§£‡§§‡•á‡§π‡•Ä ‡§Æ‡•â‡§°‡•á‡§≤ ‡§∏‡§æ‡§™‡§°‡§≤‡•á ‡§®‡§æ‡§π‡•Ä. \n‡•ß. Google Cloud ‡§Æ‡§ß‡•ç‡§Ø‡•á API 'Enable' ‡§Ö‡§∏‡§≤‡•ç‡§Ø‡§æ‡§ö‡•Ä ‡§ñ‡§æ‡§§‡•ç‡§∞‡•Ä ‡§ï‡§∞‡§æ. \n‡•®. ‡§®‡§µ‡•Ä‡§® Key ‡§µ‡§æ‡§™‡§∞‡•Ç‡§® ‡§™‡§π‡§æ.";
    }
}
</script>

</body>
</html>
