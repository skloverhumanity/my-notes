<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Mind Map Builder</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; --text: #1e293b; }
        body { font-family: 'Inter', sans-serif; margin: 0; background-color: var(--bg); color: var(--text); height: 100vh; display: flex; flex-direction: column; }
        header { background: var(--primary); color: white; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .main-container { display: flex; flex: 1; overflow: hidden; }
        
        /* Editor Area */
        .editor-container { width: 380px; display: flex; flex-direction: column; background: white; border-right: 1px solid #ddd; padding: 15px; }
        textarea { flex: 1; width: 100%; padding: 15px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 14px; font-family: monospace; outline: none; }
        
        .toolbar { margin-top: 10px; display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        button { padding: 10px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.2s; }
        .btn-download { background: #10b981; color: white; }
        .btn-update { background: #2563eb; color: white; }
        .btn-clear { background: #ef4444; color: white; }
        button:hover { opacity: 0.9; transform: translateY(-1px); }

        /* Viewer Area */
        .viewer-container { flex: 1; padding: 40px; overflow: auto; background: #ffffff; display: flex; justify-content: center; align-items: flex-start; }
        #capture-area { padding: 20px; background: white; min-width: 500px; display: flex; justify-content: center; }

        @media (max-width: 768px) {
            .main-container { flex-direction: column; }
            .editor-container { width: 100%; height: 40%; }
            #capture-area { min-width: 100%; }
        }
    </style>
</head>
<body>

<header>
    <span>üöÄ My MindMap Pro v2.0</span>
    <span style="font-size: 12px;">Auto-Saving...</span>
</header>

<div class="main-container">
    <div class="editor-container">
        <textarea id="noteInput" oninput="renderMap()" placeholder="‡§á‡§•‡•á ‡§®‡•ã‡§ü‡•ç‡§∏ ‡§≤‡§ø‡§π‡§æ...">
mindmap
  root((‡§Æ‡§æ‡§ù‡§æ ‡§™‡•ç‡§∞‡•ã‡§ú‡•á‡§ï‡•ç‡§ü))
    ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏
      ‡§Æ‡§∞‡§æ‡§†‡•Ä
      ‡§ó‡§£‡§ø‡§§
    ‡§ï‡§æ‡§Æ‡§æ‡§ö‡•Ä ‡§Ø‡§æ‡§¶‡•Ä
      ‡§¨‡§æ‡§ú‡§æ‡§∞
      ‡§¨‡§Å‡§ï
        </textarea>
        
        <div class="toolbar">
            <button class="btn-update" onclick="renderMap()">Update</button>
            <button class="btn-download" onclick="exportImage()">Download Image</button>
            <button class="btn-clear" onclick="clearAll()">Clear</button>
            <button style="background:#64748b; color:white;" onclick="copyLink()">Copy Link</button>
        </div>
    </div>

    <div class="viewer-container">
        <div id="capture-area">
            <div id="graphDiv" class="mermaid"></div>
        </div>
    </div>
</div>

<script>
    mermaid.initialize({ startOnLoad: true, theme: 'forest', securityLevel: 'loose' });

    window.onload = () => {
        const saved = localStorage.getItem('proMindMap');
        if (saved) document.getElementById('noteInput').value = saved;
        renderMap();
    };

    async function renderMap() {
        const input = document.getElementById('noteInput').value;
        const output = document.getElementById('graphDiv');
        localStorage.setItem('proMindMap', input); // Auto Save
        
        output.removeAttribute('data-processed');
        output.innerHTML = input;
        try {
            await mermaid.run({ nodes: [output] });
        } catch (e) {}
    }

    // Direct Image Download Function
    function exportImage() {
        const area = document.getElementById('capture-area');
        const btn = document.querySelector('.btn-download');
        btn.innerText = "Processing...";
        
        html2canvas(area, {
            backgroundColor: "#ffffff",
            scale: 2 // High Quality
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'my-mindmap.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
            btn.innerText = "Download Image";
        });
    }

    function clearAll() {
        if(confirm("‡§∏‡§æ‡§µ‡§ß‡§æ‡§®! ‡§∏‡§∞‡•ç‡§µ ‡§®‡•ã‡§ü‡•ç‡§∏ ‡§™‡•Å‡§∏‡§≤‡•ç‡§Ø‡§æ ‡§ú‡§æ‡§§‡•Ä‡§≤.")) {
            document.getElementById('noteInput').value = "mindmap\n  root((‡§µ‡§ø‡§∑‡§Ø))";
            renderMap();
        }
    }

    function copyLink() {
        navigator.clipboard.writeText(window.location.href);
        alert("Link Copied!");
    }
</script>

</body>
</html>
