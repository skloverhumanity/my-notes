<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <title>AI MindMap - Fixed Version</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        .sidebar { width: 300px; background: white; padding: 25px; border-right: 1px solid #ddd; box-shadow: 2px 0 10px rgba(0,0,0,0.05); }
        .viewer { flex: 1; display: flex; justify-content: center; align-items: center; background: #e9ecef; overflow: auto; }
        input, textarea { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #1a73e8; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        #status { font-size: 13px; color: #d93025; margin-top: 10px; font-weight: bold; }
        img { max-width: 95%; box-shadow: 0 10px 30px rgba(0,0,0,0.15); border-radius: 12px; display: none; background: white; }
    </style>
</head>
<body>

<div style="display: flex; flex: 1;">
    <div class="sidebar">
        <h3 style="color: #1a73e8;">üß† AI MindMap</h3>
        <label style="font-size: 11px;">‡§§‡•Å‡§Æ‡§ö‡•Ä API Key ‡§ü‡§æ‡§ï‡§æ:</label>
        <input type="password" id="apiKey" placeholder="Gemini Key ‡§á‡§•‡•á ‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡§æ">
        <label style="font-size: 11px;">‡§µ‡§ø‡§∑‡§Ø:</label>
        <textarea id="topic" rows="4" placeholder="‡§â‡§¶‡§æ. Backtesting with GRU and LSTM"></textarea>
        <button onclick="makeMap()">AI ‡§Æ‡•Ö‡§™ ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§æ ‚ú®</button>
        <div id="status">Ready</div>
    </div>
    <div class="viewer">
        <div id="loader" style="display:none; font-weight: bold;">AI ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§§ ‡§Ü‡§π‡•á... ‡§ï‡•É‡§™‡§Ø‡§æ ‡§•‡•ã‡§°‡§æ ‡§µ‡•á‡§≥ ‡§•‡§æ‡§Ç‡§¨‡§æ.</div>
        <img id="mapResult" src="">
    </div>
</div>

<script>
async function makeMap() {
    const key = document.getElementById('apiKey').value.trim();
    const topic = document.getElementById('topic').value.trim();
    const status = document.getElementById('status');
    const img = document.getElementById('mapResult');
    const loader = document.getElementById('loader');

    if (!key || !topic) { alert("Key ‡§Ü‡§£‡§ø ‡§µ‡§ø‡§∑‡§Ø ‡§¶‡•ã‡§®‡•ç‡§π‡•Ä ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§Ü‡§π‡•á‡§§!"); return; }

    status.style.color = "#1a73e8";
    status.innerText = "‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä ‡§∂‡•ã‡§ß‡§§ ‡§Ü‡§π‡•á...";
    loader.style.display = "block";
    img.style.display = "none";

    // ‡§¨‡§¶‡§≤: ‡§Ü‡§™‡§£ ‡§Ü‡§§‡§æ 'gemini-pro' ‡§µ‡§æ‡§™‡§∞‡§§ ‡§Ü‡§π‡•ã‡§§ ‡§ú‡•á ‡§∏‡§∞‡•ç‡§µ ‡§´‡•ç‡§∞‡•Ä ‡§ï‡•Ä ‡§µ‡§∞ ‡§ö‡§æ‡§≤‡§§‡•á
    const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${key}`;

    const prompt = `Create a Mermaid mindmap for "${topic}". Include branches for GRU and LSTM models for faster backtesting. Give ONLY the mermaid code starting with "mindmap". No markdown.`;

    try {
        const response = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
        });

        const data = await response.json();

        if (data.candidates && data.candidates[0].content) {
            let aiCode = data.candidates[0].content.parts[0].text;
            // ‡§è‡§ï‡•ç‡§∏‡•ç‡§ü‡•ç‡§∞‡§æ ‡§Æ‡§ú‡§ï‡•Ç‡§∞ ‡§ï‡§æ‡§¢‡§£‡•á
            let cleanCode = aiCode.replace(/```mermaid|```/g, "").trim();
            if (!cleanCode.includes("mindmap")) cleanCode = "mindmap\n" + cleanCode;
            
            // ‡§á‡§Æ‡•á‡§ú ‡§¨‡§®‡§µ‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä Kroki API ‡§≤‡§æ ‡§™‡§æ‡§†‡§µ‡§£‡•á
            const encoded = btoa(unescape(encodeURIComponent(cleanCode)));
            img.src = `https://kroki.io/mermaid/svg/${encoded}`;
            
            img.onload = () => {
                loader.style.display = "none";
                img.style.display = "block";
                status.style.color = "green";
                status.innerText = "‡§Æ‡•Ö‡§™ ‡§§‡§Ø‡§æ‡§∞ ‡§ù‡§æ‡§≤‡§æ! ‚úÖ";
            };
        } else {
            status.style.color = "red";
            status.innerText = "Error: " + (data.error ? data.error.message : "Key ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§ ‡§®‡§æ‡§π‡•Ä‡§Ø‡•á.");
            loader.style.display = "none";
        }
    } catch (e) {
        status.innerText = "‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§è‡§∞‡§∞! ‡§™‡•Å‡§®‡•ç‡§π‡§æ ‡§™‡•ç‡§∞‡§Ø‡§§‡•ç‡§® ‡§ï‡§∞‡§æ.";
        loader.style.display = "none";
    }
}
</script>

</body>
</html>
