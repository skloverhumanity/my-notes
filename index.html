<script>
async function generate() {
    const key = document.getElementById('apiKey').value.trim();
    const topic = document.getElementById('topic').value.trim();
    const status = document.getElementById('status');
    const img = document.getElementById('resImg');

    if(!key) { alert("Key टाका!"); return; }

    status.innerText = "योग्य मॉडेल शोधत आहे...";
    img.style.display = "none";

    // या ३ नावांपैकी एक तुमच्या प्रोजेक्टला नक्कीच सपोर्ट करेल
    const modelList = ["gemini-1.5-flash", "gemini-1.5-flash-8b", "gemini-pro"];
    let success = false;

    for (let modelName of modelList) {
        if (success) break;
        status.innerText = `Trying: ${modelName}...`;

        try {
            const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${key}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: [{ parts: [{ text: `Create mermaid mindmap for ${topic}. Give only code.` }] }] })
            });

            const data = await res.json();

            if (data.candidates) {
                let code = data.candidates[0].content.parts[0].text.replace(/```mermaid|```/g, "").trim();
                const encoded = btoa(unescape(encodeURIComponent(code)));
                img.src = `https://kroki.io/mermaid/svg/${encoded}`;
                img.style.display = "block";
                status.style.color = "green";
                status.innerText = `यशस्वी! (${modelName} वापरले)`;
                success = true;
            }
        } catch (e) {
            console.log(modelName + " failed");
        }
    }

    if (!success) {
        status.style.color = "red";
        status.innerText = "कोणतेही मॉडेल सापडले नाही. कृपया तुमची की पुन्हा तपासा.";
    }
}
</script>
