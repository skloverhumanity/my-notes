async function generateMap() {
    const key = document.getElementById('apiKey').value.trim();
    const topic = document.getElementById('topic').value.trim();
    const status = document.getElementById('status');

    if (!key) { alert("कृपया आधी Key टाका!"); return; }

    status.innerText = "तपासत आहे...";

    try {
        // आपण आता थेट गुगलला विचारूया की ही की चालते का
        const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ contents: [{ parts: [{ text: "Hello, answer in 1 word." }] }] })
        });

        const data = await res.json();

        if (data.error) {
            // गुगलने दिलेला खरा मेसेज दाखवणे
            status.style.color = "red";
            status.innerHTML = "<b>API Error:</b> " + data.error.message + 
                               "<br><br><i>टिप: गुगल क्लाउड कन्सोलमध्ये 'Generative Language API' Enable करा.</i>";
            console.log(data.error);
        } else {
            status.style.color = "green";
            status.innerText = "तुमची की एकदम बरोबर आहे! मॅप तयार होत आहे...";
            // मॅप बनवण्याची पुढची स्टेप इथे सुरू होईल...
        }
    } catch (e) {
        status.innerText = "नेटवर्क एरर! इंटरनेट तपासा.";
    }
}
